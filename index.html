<!DOCTYPE html>
<html>
<head>
    <title>Flask App</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>Flask App</h1>

    <!-- Serial Port Dropdown -->
    <label for="serialPort">Serial Port:</label>
    <select id="serialPort"></select>

    <!-- Network Interface Dropdown -->
    <label for="networkInterface">Network Interface:</label>
    <select id="networkInterface"></select>

    <button id="track-button" style="display: none;">Track</button>
    <table id="iwlist-table">
        <thead>
            <tr>
                <th>Select</th>
                <th>Command</th>
                <th>Output</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            $.getJSON('/get_serial_ports', function(data) {
                data.serial_ports.forEach(function(port) {
                    $('#serialPort').append($('<option>', { value: port, text: port }));
                });
            });

            $.getJSON('/get_network_interfaces', function(data) {
                data.network_interfaces.forEach(function(interface) {
                    $('#networkInterface').append($('<option>', { value: interface, text: interface }));
                });
            });

            var commands = ["frequency", "rate", "keys", "power", "txpower", "retry", "event", "auth", "wpakeys", "genie", "modulation"];

            $("#networkInterface").change(function() {
                var interface = $(this).val();
                $("#iwlist-table tbody").empty();

                commands.forEach(function(command) {
                    $.post("/iwlist", {interface: interface, command: command}, function(data) {
                        var row = $("<tr>");
                        row.append($("<td>").append($("<input>").attr({type: "checkbox"})));
                        row.append($("<td>").text(command));
                        row.append($("<td>").text(data.output));
                        $("#iwlist-table tbody").append(row);
                    });
                });
            });

            $("#iwlist-table").on("change", "input[type='checkbox']", function() {
                if ($("#iwlist-table input[type='checkbox']:checked").length > 0) {
                    $("#track-button").show();
                } else {
                    $("#track-button").hide();
                }
            });

            $("#track-button").click(function() {
                $("#iwlist-table input[type='checkbox']:checked").each(function() {
                    var command = $(this).closest("tr").find("td:nth-child(2)").text();
                    console.log("Tracking " + command); // replace this with your actual tracking code
                });
            });
        });
    </script>
</body>
</html>
